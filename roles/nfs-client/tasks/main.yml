---
    - name: Update yum
      yum:
        update_cache: yes
    - name: Install NFS client package
      yum:
        name: nfs-utils
        state: present
    - name: install git
      yum:
        name: git
        state: present
    - name: Create mount point
      file:
        path: "{{ nfs_mount_point }}"
        state: directory
        owner: "{{ nfs_user }}"
        group: "{{ nfs_group }}"
        mode: 0775
    - name: allow firewall to 2049
      shell: firewall-cmd --zone=public --add-port=2049/tcp --permanent
    - name: allow firewall to gogs port
      shell: firewall-cmd --zone=public --add-port=3000/tcp --permanent
    - name: reload firewall
      shell: firewall-cmd --reload
    - name: Mount NFS share
      mount:
        path: "{{ nfs_mount_point }}"
        src: "{{ nfs_server_ip }}:{{ nfs_shared_dir }}"
        fstype: nfs
        state: mounted
        opts: rw,sync,hard,intr
    - name: delete past gogs
      file:
        path: /home/user/gogs
        state: absent
    - name: install gogs
      copy:
        src: /home/user/gogs
        dest: /home/user/gogs
    - name: change file owner and group to user
      file:
        path: /home/user/gogs
        owner: user
        group: user
    - name: change gogs mod to 775
      file:
        path: /home/user/gogs
        mode: 0775
    - name: create directory custom
      file:
        path: /home/user/custom
        state: directory
    - name: create directory conf
      file:
        path: /home/user/custom/conf
        state: directory
    - name: install gogs conf
      template: 
        src: app.ini.j2
        dest: /home/user/custom/conf/app.ini
      vars:
        mariadb_ip: 10.26.0.61
    - name: install gogs start script
      template:
        src: start-gogs.sh.j2
        dest: /home/user/start-gogs.sh
    - name: change mode of script
      file:
        path: /home/user/start-gogs.sh
        owner: user
        group: user
        mode: 0775
    - name: start gogs
      shell: /home/user/start-gogs.sh
      async: 5
      poll: 0
 
